<template>  <div class="page categories-page" v-if="categories">    <div class="page-header">      <div class="actions-section">        <div class="search-block">          <input type="text" :placeholder="$t('page.search')" v-model="search">          <div class="search-icon">            <svg-sprite width="17" height="17" icon-id="search"></svg-sprite>          </div>        </div>        <div class="actions-buttons">          <v-tooltip bottom>            <template v-slot:activator="{ on, attrs }">              <v-btn :disabled="!categories.length" v-bind="attrs" v-on="on" icon color="indigo"                     class="action-btn sortable-btn">                <svg-sprite width="13" height="12" icon-id="sort"></svg-sprite>              </v-btn>            </template>            <span>Сортировка по алфавиту</span>          </v-tooltip>          <v-tooltip bottom>            <template v-slot:activator="{ on, attrs }">              <v-btn                  :disabled="selectedCategories.length !== 1"                  @click="onCopySelectedCategory(selectedCategories)"                  v-bind="attrs"                  v-on="on"                  color="#9DCCFF" fab small                  class="action-btn circle-btn">                <svg-sprite width="16" height="16" icon-id="contextMenuCopy"                ></svg-sprite>              </v-btn>            </template>            <span>Копировать</span>          </v-tooltip>          <v-tooltip bottom>            <template v-slot:activator="{ on, attrs }">              <v-btn                  :disabled="!selectedCategories.length"                     @click="onDeleteCategories(selectedCategories)" v-bind="attrs"                     v-on="on" color="#9DCCFF" fab small class="action-btn circle-btn">                <svg-sprite width="13" height="15" icon-id="bin"                ></svg-sprite>              </v-btn>            </template>            <span>Удалить</span>          </v-tooltip>        </div>      </div>      <v-btn class="orange-btn" @click="createCategory">        <svg-sprite width="14" height="14" icon-id="plus"></svg-sprite>        <span>{{ $t('page.addButton') }}</span>      </v-btn>    </div>    <div class="card-grid">      <div class="card categories-list">        <div            class="switch-nesting"            :class="{disabled: !categories.length}"        >            <span                class="switch-text"                @click="switchNesting = false"                :class="{active: !switchNesting}">              Скрыть            </span>          <switcher @toggle="onToggleNested" :value="switchNesting"></switcher>          <span class="switch-text" @click="switchNesting = true"                :class="{active: switchNesting}">Открыть вложеность</span>        </div>        <simplebar class="categories-simplebar">          <v-skeleton-loader :loading="loading" height="404" type="sentences@10">            <categories-list                @open-node="switchNesting = true"                :serch="search"                :units="units"                :is-edit-category="isEditCategories"                :selectedCategories="selectedCategories"                :nested="switchNesting"                :activeId="currentCategoryId"                v-if="categories.length"                @selectCategory="onSelectCategory"                @copyCategory="onCopyCategory"                @moveCategory="onMoveCategory"                @deleteCategory="onDeleteCategories"                @sortCategories="onSortCategories"                @show-alert="onShowAlert"                @reset-edit-category="onResetEditCategory"                @updateClose="onClose"                :moveLoading="moveLoading"            />            <div v-else class="add-new" @click="createCategory"><span>Создать категорию</span></div>          </v-skeleton-loader>        </simplebar>      </div>      <simplebar class="card category-single" force-visible>        <div class="select-item" v-if="showSelectText && categories.length">          <img src="@/assets/icons/area-bg.svg" alt="">          <span>            {{ $t('page.selectCategory') }}          </span>        </div>        <div v-if="showSelectText && !categories.length" class="select-item">          <img src="@/assets/icons/area-bg.svg" alt="">          <span>            {{ $t('page.createCategory') }}          </span>        </div>        <router-view            :units="units"            :closeDetails="closeDetails"            name="helper"            class="category-wrap"        ></router-view>      </simplebar>      <simplebar force-visible>        <category-create            class="dialog-category"            ref="createCategory"            :units="units"            :categories="categories"            @show-alert="onShowAlert"            bookMarkTitle="Добавить категорию"            bookMarkId="addCategory"        />      </simplebar>      <div v-if="selectedCategories.length" class="table-controls">        <div class="controls-list" v-if="actions.length">          <div class="controls-list-item" v-for="(val, index) in actions" :key="index">            <button                v-if="val.type === 'copy'"                class="control-btn"                :disabled="selectedCategories.length !== 1"                type="button"                @click.prevent="onClickCopy"            >              <span class="icon">                <svg-sprite width="21" height="21" icon-id="contextMenuLargeCopy"></svg-sprite>              </span>            </button>            <button                v-if="val.type === 'move'"                :disabled="selectedCategories.length !== 1"                class="control-btn"                type="button"                @click="onClickMove"            >              <span class="icon">                <svg-sprite width="46" height="46" icon-id="contextMenuLargeMove"></svg-sprite>              </span>            </button>            <button                v-if="val.type === 'edit'"                :disabled="selectedCategories.length !== 1"                @click="onClickChange"                class="control-btn"                type="button"            >              <span class="icon">                <svg-sprite width="23" height="23" icon-id="contextMenuLargeEdit"></svg-sprite>              </span>            </button>            <button                v-if="val.type === 'delete'"                :disabled="selectedCategories.length < 1"                @click="onClickDel"                class="control-btn"                type="button"              >              <span class="icon">                <svg-sprite width="19" height="21" icon-id="contextMenuLargeRemove"></svg-sprite>              </span>            </button>          </div>        </div>      </div>    </div>    <alert        v-if="isAlertShow"        @close-alert="onCloseAlert"        @view-item="onShowItem"        :text-items="alertTextItems"        :link="alertLink"    ></alert>    <move-categories        ref="MoveCategory"        @save="onSaveMoveCategories"        :categories="categories"        isHideBtnAdd    ></move-categories>  </div></template><script>// vueximport {mapActions, mapGetters} from 'vuex';// componentsimport Alert from "@/components/dashboard/products/nomenclature/ui/Alert"import CategoriesList from "@/components/dashboard/categories/CategoriesList"import CategoryCreate from "@/components/dashboard/categories/CategoryCreate"import MoveCategories from "@/components/dashboard/categories/MoveCategories";import Switcher from "@/components/ui/Swithcer";export default {  name: "Categories",  components: {    MoveCategories,    Switcher,    CategoriesList,    CategoryCreate,    Alert  },  props: {    value: {      required: false    }  },  data: () => ({    search: '',    selectedCategories: [],    create: false,    switchNesting: true,    showSelectText: true,    loading: true,    moveLoading: false,    isAlertShow: false,    alertTextItems: [],    alertLink: false,    list: [],    isEditCategories: false,    actions: [      {type: 'edit'},      {type: 'copy'},      {type: 'move'},      {type: 'delete'}    ]  }),  watch: {    $route(to) {      this.getBookMarks(to.params);    }  },  async created() {    await this.fetchLists({ type: '', resources: 'units' });  },  computed: {    ...mapGetters(['categories', 'category', 'getLists']),    units() {      return this.getLists('lists')['units']    },    currentCategoryId() {      return this.category ? this.category.id : null    },  },  methods: {    ...mapActions({      deleteCategories: 'deleteCategory',      resetCategory: 'resetCategory',      moveCategories: 'moveCategories',      sortCategories: 'sortCategories',      fetchCategory: 'fetchCategory',      fetchCategories: "fetchCategories",      fetchLists: 'fetchLists',    }),    onClose() {      this.isEditCategories = false;    },    onClickChange() {      this.isEditCategories = true    },    onClickDel() {      this.onDeleteCategories(this.selectedCategories)    },    onClickMove() {      this.recursiveGetCategory(this.categories, ...this.selectedCategories)      // this.onMoveCategory(id)    },    onClickCopy() {      this.onCopyCategory(...this.selectedCategories)    },    recursiveGetCategory(categories, id) {      categories.forEach(category => {        if (category.id === id.id) {          this.onMoveCategory({ data: category })        } else {          this.recursiveGetCategory(category.children, id)        }      })    },    onShowAlert({textItems, link}) {      this.alertTextItems = textItems      this.alertLink = link || false      this.showAlert()    },    onResetEditCategory() {      this.isEditCategories = false    },    onShowItem({url}) {      this.$router.push(url)    },    async onSaveMoveCategories({data, alertParams}) {      await this.moveCategories(data)      await this.fetchCategories()      this.onShowAlert(alertParams);      this.$refs.MoveCategory.close()    },    onCloseAlert() {      this.isAlertShow = false    },    showAlert() {      this.isAlertShow = true      setTimeout(          () => {            this.isAlertShow = false          },          2500      )    },    createCategory() {      this.$refs.createCategory.open(null, { category: null, mode: 'create'})    },    onDeleteCategories(categoriesToDelete) {      this.deleteCategories(categoriesToDelete).then(() => {        this.selectedCategories = []      })      this.$router.push('/products/categories/');    },    async onSortCategories({moveParams, sortParams}) {      this.moveLoading = true;      await this.moveCategories(moveParams).then(() => {        this.sortCategories(sortParams)      })      this.moveLoading = false;    },    onCopySelectedCategory(selectedArr) {      const id = selectedArr[0].id      this.onCopyCategory({id})      this.selectedCategories = []    },    onToggleNested({value}) {      if (!value) {        this.resetCategory()      }      this.switchNesting = value    },    onCopyCategory({ id }) {      this.fetchCategory(id).then(() => {        const parent_id = this.category.parent_id || null        const params = {          category: this.category,          mode: 'copy'        }        this.$refs.createCategory.open(parent_id, params)      })    },    onMoveCategory({ data }) {      this.$refs.MoveCategory.open(data)    },    closeDetails() {      this.create = false      this.showSelectText = !this.showSelectText    },    onSelectCategory(values) {      if (Array.isArray(values)) {        values.forEach(itemId => {          const index = this.selectedCategories.findIndex(item => item.id === itemId);          if (index === -1) {            this.selectedCategories.push({ id: itemId })          } else {            this.selectedCategories.splice(index, 1)          }        })      } else {        const { id } = values;        const index = this.selectedCategories.findIndex(item => item.id === id);        if (index === -1) {          this.selectedCategories.push({id})        } else {          this.selectedCategories.splice(index, 1)        }      }    },    getBookMarks(data) {      const { params } = data;      //this.$router.go(-1);      if (params) {        if(params === 'addCategory') {          this.createCategory();        }      }    }  },  async mounted() {    await this.$store.dispatch('fetchCategories')    this.loading = false    await this.$store.dispatch('fetchDataCreate')    this.getBookMarks(this.$route.params);  }}</script><style lang="sass" scoped>.table-controls  position: absolute  bottom: 100px.categories-simplebar  height: calc(100% - 70px).switch-nesting  .switch-text    &:first-child      margin-right: 10px    &:last-child      margin-left: 10px  .categories-simplebar    max-height: calc(100% - 90px)  .page .list-group li    flex-wrap: wrap    height: auto    display: block</style>